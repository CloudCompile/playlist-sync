name: Daily Music Sync

on:
  schedule:
    - cron: '0 12 * * *' # This runs every day at 12:00 UTC
  workflow_dispatch: # This allows you to run it manually anytime

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: pip install requests spotipy beautifulsoup4

      - name: Create Spotify Session Cache
        # This "fakes" the login file so the script thinks you are already logged in
        run: |
          echo '{"access_token": "temp", "token_type": "Bearer", "expires_in": 3600, "refresh_token": "${{ secrets.SPOTIPY_REFRESH_TOKEN }}", "scope": "playlist-read-private playlist-read-collaborative playlist-modify-private playlist-modify-public user-read-private", "expires_at": 1800000000}' > .cache

      - name: Run Sync Script
        env:
          CLIENT_ID: ${{ secrets.SPOTIPY_CLIENT_ID }}
          CLIENT_SECRET: ${{ secrets.SPOTIPY_CLIENT_SECRET }}
          REDIRECT_URI: 'http://localhost:8000'
        # Note: If the main script name is different, change 'main.py' below
        run: python sync.py
